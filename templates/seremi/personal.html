{% extends "base.html" %}
{% block title %}Registro del Personal{% endblock %}
{% block content %}

<h2 class="text-white">Registro de Control de Manipuladores</h2>
<p class="text-white">Consulta mensual por sucursal.</p>

<form method="get" class="row g-3 text-white mb-4">
  <div class="col-md-4">
    <label for="sucursal" class="form-label">Sucursal</label>
    <select name="sucursal" id="sucursal" class="form-select">
      {% for s in sucursales %}
        <option value="{{ s }}" {% if s == sucursal_activa %}selected{% endif %}>{{ s }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-4">
    <label for="mes" class="form-label">Mes</label>
    <select name="mes" id="mes" class="form-select">
      {% for num, nombre in meses %}
        <option value="{{ num }}" {% if num == mes_actual %}selected{% endif %}>{{ nombre }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-4 d-flex align-items-end">
    <button type="submit" class="btn btn-danger w-100">Aplicar Filtros</button>
  </div>
</form>
<div class="text-end mb-4">
    <a class="btn btn-danger" target="_blank"
      href="{{ url_for('seremi.imprimir_personal', sucursal=sucursal_activa, mes=mes_actual) }}">
      üñ®Ô∏è Ver como PDF (imprimir)
    </a>
</div>

{% if data_por_sucursal %}
  {% for sucursal, dias in data_por_sucursal.items() %}
    <div class="mb-5 p-3 border rounded bg-dark">
      <h3 class="text-white border-bottom pb-2 mb-3">Sucursal: {{ sucursal }}</h3>
      {% for fecha, registros_del_dia in dias.items() %}
      <div class="mb-4">
        <h5 class="text-danger ps-2">D√≠a: {{ fecha.strftime('%d-%m-%Y') }}</h5>

        {% if registros_del_dia %}
          <div class="table-responsive">
            <table class="table table-dark table-bordered text-center" style="font-size: 0.8rem;">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Pelo Limpio</th>
                  <th>Afeitado</th>
                  <th>U√±as</th>
                  <th>Joyas</th>
                  <th>Uniforme</th>
                  <th>Cofia</th>
                  <th>Mascarilla</th>
                  <th>Salud</th>
                  <th>Acciones Correctivas</th>
                </tr>
              </thead>
              <tbody>
                {% for r in registros_del_dia %}
                  <tr>
                    <td>{{ r.nombre_manipulador }}</td>
                    <td>{{ r.pelo_limpio }}</td>
                    <td>{{ r.afeitado }}</td>
                    <td>{{ r.unas_cortas }}</td>
                    <td>{{ r.joyas }}</td>
                    <td>{{ r.uniforme }}</td>
                    <td>{{ r.cofia }}</td>
                    <td>{{ r.mascarilla }}</td>
                    <td>{{ r.salud }}</td>
                    <td class="text-start">{{ r.get('acciones_correctivas', '') or '' }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="text-muted ps-3" style="font-style: italic;">-- Sin registros para este d√≠a --</p>
        {% endif %}
      </div>
    {% endfor %}
    </div>
  {% endfor %}
{% else %}
  <p class="text-warning">No hay registros para los filtros seleccionados.</p>
{% endif %}

{% endblock %}