<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Huentelauquén{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/estilos.css') }}" rel="stylesheet">
    <style>
        body {
            background-color: #000;
            color: #fff;
        }
        .sidebar {
            height: 100vh;
            background-color: #111;
            padding-top: 20px;
        }
        .sidebar a {
            color: white;
            padding: 12px;
            display: block;
            text-decoration: none;
        }
        .sidebar a:hover {
            background-color: #d80000;
            color: white;
        }
        .main-content {
            margin-left: 220px;
            padding: 20px;
        }
    </style>
</head>

<div id="loading-overlay">
    <div class="spinner"></div>
    <p>Actualizando todos los datos, por favor espere...</p>
</div>

<body>

<div class="d-flex">
    <div class="sidebar position-fixed">
        <div class="text-center mb-4">
            <a href="/refresh" title="Actualizar datos">

            <a href="/refresh" title="Actualizar datos" onclick="mostrarOverlay()">
                <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo" width="120">
            </a>
        </div>
        {% if fecha_actualizacion %}
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; width: auto; max-width: 90%;">
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
                    </div>
                {% endfor %}
                </div>
            {% endif %}
        {% endwith %}


        <div style="font-size: 0.7rem; color: #ccc; font-style: italic;">
            Última actualización: {{ fecha_actualizacion.strftime("%d/%m/%Y %H:%M") }}
        </div>
        {% endif %}

        <a href="{{ url_for('dashboard.dashboard') }}">Dashboard</a>
        <a href="{{ url_for('ventas.ventas') }}">Ventas</a>
        <!-- Menú SEREMI -->
        <div class="dropdown">
            <a class="dropdown-toggle d-block px-3 py-2 text-white" href="#" role="button" id="seremiDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                Seremi
            </a>
            <ul class="dropdown-menu bg-dark border-0" aria-labelledby="seremiDropdown">
                <li><a class="dropdown-item text-white" href="{{ url_for('seremi.temperatura_equipos') }}">Temperatura Equipos</a></li>
                <li><a class="dropdown-item text-white" href="{{ url_for('seremi.temperatura_productos') }}">Temperatura Productos</a></li>
                <li><a class="dropdown-item text-white" href="{{ url_for('seremi.cambio_aceite') }}">Cambio de Aceite</a></li>
                <li><a class="dropdown-item text-white" href="{{ url_for('seremi.recepcion_mercaderia') }}">Recepcion Mercaderia</a></li>
                <li><a class="dropdown-item text-white" href="{{ url_for('seremi.personal') }}">Registro del Personal</a></li>
            </ul>
        </div>
        <!-- Menú Contabilidad -->
        <div class="dropdown">
            <a class="dropdown-toggle d-block px-3 py-2 text-white" href="#" role="button" id="contabDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                Contabilidad
            </a>
            <ul class="dropdown-menu bg-dark border-0" aria-labelledby="contabDropdown">
                <li><a class="dropdown-item text-white" href="{{ url_for('contab.comparativo') }}">Comparativo</a></li>
                <li><a class="dropdown-item text-white" href="{{ url_for('contab.archivos') }}">Archivos</a></li>
            </ul>
        </div>

        <a href="#">Clientes</a>
        <a href="#">Quesería</a>
        <a href="#">Lechería</a>
        <a href="#">Fca Papaya</a>
        <a href="#">Fca Empanada</a>
        <a href="{{ url_for('auth.logout') }}">Cerrar sesión</a>
    </div>

    <div class="main-content flex-grow-1">
        {% block content %}{% endblock %}
    </div>
</div>

<!-- Bootstrap JS para habilitar pestañas -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

<!-- Activar pestaña por hash (ej: #resumen) -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const hash = window.location.hash;
    if (hash) {
      const tab = document.querySelector(`a[href="${hash}"]`);
      if (tab) {
        new bootstrap.Tab(tab).show();
      }
    }
  });
</script>


<footer class="text-end text-white p-2" style="font-size: 0.8rem;">
    Última actualización: 
    {{ fecha_actualizacion.strftime('%d-%m-%Y %H:%M') if fecha_actualizacion else 'Desconocida' }}
</footer>

<script>
  // Función para mostrar la pantalla de carga
  function mostrarOverlay() {
    document.getElementById('loading-overlay').style.display = 'flex';
  }

  // No necesitamos una función para ocultarlo, porque cuando el servidor
  // responde, la página se recarga por completo y el overlay
  // volverá a su estado original (oculto por el CSS).
</script>
</body>
</html>

